<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Population Density Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
      body {
        margin: 0;
        font-family: Arial, sans-serif;
      }

      h2 {
        margin: 1rem 0;
      }

      #map {
        height: calc(100vh - 60px);
        width: 100%;
      }

      .legend {
        background-color: white;
        padding: 10px;
        border-radius: 5px;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
        font-size: 18px;
      }

      .legend i {
        width: 18px;
        height: 18px;
        float: left;
        margin-right: 8px;
        opacity: 0.7;
      }

      .box {
        position: absolute;
        top: 70px;
        left: 50px;
        z-index: 1000;
        background: white;
        padding: 10px;
        border-radius: 5px;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
      }
    </style>
  </head>

  <body>
    <h2 style="text-align: center">Washington Population Density</h2>
    <div class="box">
      <h2>State Population</h2>
      <p>Hover over a state to uncover key Population!</p>
    </div>
    <div id="map"></div>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
      const map = L.map("map").setView([47.4, -120.5], 7);

      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        maxZoom: 18,
        attribution: "Â© OpenStreetMap",
      }).addTo(map);

      function getColor(d) {
        return d > 2000
          ? "#800026"
          : d > 1500
          ? "#BD0026"
          : d > 1000
          ? "#E31A1C"
          : d > 500
          ? "#FC4E2A"
          : d > 200
          ? "#FD8D3C"
          : d > 100
          ? "#FEB24C"
          : d > 50
          ? "#FED976"
          : "#FFEDA0";
      }

      function style(feature) {
        return {
          fillColor: getColor(feature.properties.casePer10k),
          weight: 2,
          opacity: 1,
          color: "white",
          dashArray: "3",
          fillOpacity: 0.7,
        };
      }

      function highlightFeature(e) {
        const layer = e.target;
        layer.setStyle({ weight: 3, color: "#666", fillOpacity: 0.9 });
      }

      function resetHighlight(e) {
        geojson.resetStyle(e.target);
      }

      function onEachFeature(feature, layer) {
        layer.on({ mouseover: highlightFeature, mouseout: resetHighlight });
        layer.bindTooltip(
          `${feature.properties.name}<br>` +
            `Population Density : ${feature.properties.casePer10k} <br/> (simulated data)`
        );
      }

      let geojson;

      fetch("assets/wa-covid-data-102521.geojson")
        .then((res) => res.json())
        .then((data) => {
          geojson = L.geoJson(data, { style, onEachFeature }).addTo(map);
        });

      const legend = L.control({ position: "bottomright" });
      legend.onAdd = function () {
        const div = L.DomUtil.create("div", "legend");
        div.innerHTML = "<b>Population Density <br/> (Simulated)</b> <br> <br>";
        const grades = [0, 50, 100, 200, 500, 1000, 1500, 2000];
        const colors = [
          "#FFEDA0",
          "#FED976",
          "#FEB24C",
          "#FD8D3C",
          "#FC4E2A",
          "#E31A1C",
          "#BD0026",
          "#800026",
        ];
        for (let i = 0; i < grades.length; i++) {
          div.innerHTML +=
            `<i style="background:${colors[i]}"></i>` +
            grades[i] +
            (grades[i + 1] ? "&ndash;" + grades[i + 1] + "<br>" : " and more");
        }
        return div;
      };
      legend.addTo(map);
    </script>
  </body>
</html>
